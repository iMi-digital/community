page.includeCSS.community = EXT:community/Resources/Public/CSS/default.css

tt_content.list.20.community_pi10 = USER_INT
# set the namespace so any plugin can share arguments
plugin.tx_community.view.pluginNamespace = tx_community

plugin.tx_community {
	persistence {
		storagePid = {$plugin.tx_community.persistence.storagePid}
	}

	settings {
		loginPage = {$plugin.tx_community.settings.loginPage}
		profilePage = {$plugin.tx_community.settings.profilePage}
		editProfilePage = {$plugin.tx_community.settings.editProfilePage}
		messagePage = {$plugin.tx_community.settings.messagePage}
		galleryPage = {$plugin.tx_community.settings.galleryPage}
		searchPage = {$plugin.tx_community.settings.searchPage}
		relationPage = {$plugin.tx_community.settings.relationPage}
		wallPage = {$plugin.tx_community.settings.wallPage}

		profile {
			image {
				maxWidth = 300
				maxHeight = 300
				prefix = uploads/tx_community/photos/
				types = jpeg,jpg,png,gif
				defaultImage = EXT:community/Resources/Public/Images/defaultProfileImage.png
				# in bytes, default 1048576 bytes (1MB)
				maxSize = 1048576
			}
			reasonForReportRequired = 1
			details {
				showDetails = username,gender,dateOfBirth,politicalView,religiousView,activities,interests,music,movies,books,quotes,aboutMe,address,city,zip,country,www,cellphone,phone,email
			}
		}

		album {
			image {
				prefix = uploads/tx_community/photos/
				types = jpeg,jpg,png
				# in bytes, default 1048576 bytes (1MB)
				maxSize = 1048576
			}
			#the image we see on list of albums when we have no acces to album
			unknownAlbumMainPhoto = EXT:community/Resources/Public/Images/unknownAlbumMainPhoto.png
			#the image we see on list of albums when on image in album
			dafaultAlbumMainPhoto = EXT:community/Resources/Public/Images/defaultAlbumMainPhoto.png
		}

		caching {
			Group = list,show
			User = image,details
			Relation = listSome,unconfirmed
			AclRole = list,assign
		}

		//Allows to set access to multiple actions with one 'variable'
		//Actions that user can do only on himself don't need to be here
		accessActionResourceMap {
			Message {
				write = message.write
				send = message.write
			}
			User {
				image = profile.image
				edit = profile.edit
				search = user.search
				searchBox = user.searchBox
				update = profile.edit
				details = profile.details
				interaction = profile.menu
				editImage = profile.edit.image
				report = profile.report
			}
			Relation {
				listSome = profile.relation.listSome
				list = profile.relation.list
				request = profile.relation.request
				confirm = profile.relation.confirm
				reject = profile.relation.reject
				unconfirmed = profile.relation.unconfirmed
				cancel = profile.relation.cancel
			}
			WallPost {
				list = profile.wall.list
				new = profile.wall.write
				create = profile.wall.write
			}
			Album {
				list = profile.gallery
				show = profile.gallery
			}
			Photo {
				avatar = profile.gallery.avatar
					//allows seting other users photo as avatar
					//but still need to be able to see the photo
			}
			Utils {
				flashMessagesDisplay = utils
			}
		}

		accessRules {
			#guests (not logged in), and requested user not set
			public {
				access = 0
				utils.access = 1
			}
			#guests (not logged in)
			nobody < plugin.tx_community.settings.accessRules.public
			nobody {
				access = 0
				profile.gallery.access = 1
				profile.image.access = 1
			}

			#logged in, but not a friend
			other < plugin.tx_community.settings.accessRules.nobody
			other {
				access = 0
				user.search.access = 1
				user.searchBox.access = 1
				profile.menu.access = 1
				profile.relation.listSome.access = 1
				profile.relation.list.access = 1

				#unconfirmed friend is "other"
				profile.relation.confirm.access = 1
				profile.relation.reject.access = 1
				profile.relation.request.access = 1
				profile.relation.unconfirmed.access = 1
				profile.report.access = 1

				profile.details.access = 1

				profile.gallery.access = 1
				profile.wall.list.access = 1
			}

			friend < plugin.tx_community.settings.accessRules.other
			friend {
				access = 0
				message.write.access = 1
				profile.relation.access = 1
				profile.relation.cancel.access = 1
				profile.wall.write.access = 1
			}
		}

		notification {
			// Layouts and partials not supported
			templateRootPath = EXT:community/Resources/Private/Templates
			defaults {
				handler = Tx_Community_Service_Notification_MailHandler
				serverEmail = {$plugin.tx_community.serverEmail}
			}
			rules {

				relationRequest {
					10 {
						template = RelationRequest
					}
				}
				relationConfirm {
					10 {
						template = RelationConfirm
					}
				}
				relationReject {
					10 {
						template = RelationReject
					}
				}
				relationCancel {
					10 {
						template = RelationCancel
					}
				}
				#admin notification about bad profile
				userReport {
					10 {
						template = UserReport
						recipient = {$plugin.tx_community.adminEmail}
						overrideRecipient = 1
						replyToSenderUser = 1
					}
				}
				#notification about private message
				messageSend {
					10 {
						template = MessageSend
					}
				}
				#notification about wall message
				wallPostCreate {
					10 {
						template = WallPostCreate
					}
				}
			}
		}

		debug = 0

		#css-like path to the element, on it's beginning flashMessages would be displayed
		#it would be used by jQuery
		#eg.
		# flashMessagesDisplayer.where = .contents
		flashMessagesDisplayer.where = body
	}
}

config.tx_extbase {
	persistence.classes {
		Tx_Community_Domain_Model_User {
			mapping {
				tableName = fe_users
				userGroup.foreignClass = Tx_Extbase_Domain_Model_FrontendUserGroup
				columns {
					profile_image.mapOnProperty = image
				}
			}
		}
		Tx_Extbase_Domain_Model_FrontendUserGroup {
			mapping {
				tableName = fe_groups
				recordType = Tx_Extbase_Domain_Model_FrontendUserGroup
				columns {
					lockToDomain.mapOnProperty = lockToDomain
				}
			}
		}
		Tx_Community_Domain_Model_Message {
			mapping {
				columns {
					tx_community_read.mapOnProperty = read
				}
			}
		}
	}
}

config.tx_extbase.objects {
	Tx_Community_Service_Access_AccessServiceInterface {
		className = Tx_Community_Service_Access_SimpleAccessService
	}
	Tx_Community_Service_Cache_CacheServiceInterface {
		# disable internal caching
		className = Tx_Community_Service_Cache_NoCacheService
	}
	Tx_Community_Service_Notification_NotificationServiceInterface {
		className = Tx_Community_Service_Notification_NotificationService
	}
}

plugin.tx_community.flashMessagesDisplayer = USER_INT
plugin.tx_community.flashMessagesDisplayer {
    userFunc = tx_extbase_core_bootstrap->run
    extensionName = Community
    pluginName = FlashMessagesDisplayer
}
